# 模板上传功能测试指南

## 测试前准备

### 1. 确认后端服务运行
```bash
# 检查后端是否运行在 http://localhost:9099
curl http://localhost:9099/docs
```

### 2. 确认前端服务运行
```bash
# 前端应该运行在 http://localhost:80
# 浏览器访问: http://localhost
```

### 3. 准备测试文件
- Word文档（.doc 或 .docx）：用于测试模板文件上传
- 图片文件（.jpg, .png等）：用于测试缩略图上传
- 大文件（>10MB）：用于测试文件大小限制
- 非Word文件（.pdf, .txt等）：用于测试文件类型验证

## 测试步骤

### 测试1：正常上传流程

1. **登录系统**
   - 访问 http://localhost
   - 使用管理员账号登录（admin/admin123）

2. **进入模板管理页面**
   - 导航到：论文系统 > 模板管理

3. **点击"新增模板"按钮**
   - 应该弹出对话框
   - 对话框标题：新增模板

4. **填写基本信息**
   ```
   模板名称：测试模板001
   模板类型：选择一个类型（如：本科论文）
   模板描述：这是一个测试模板
   ```

5. **上传模板文件**
   - 点击"上传Word模板"按钮
   - 选择一个Word文档（.docx）
   - 等待上传完成
   - ✅ 应该显示：模板文件上传成功
   - ✅ 应该显示文件名在上传列表中

6. **上传缩略图**
   - 点击缩略图上传区域
   - 选择一张图片
   - 等待上传完成
   - ✅ 应该显示：缩略图上传成功
   - ✅ 应该显示图片预览

7. **保存模板**
   - 点击"确定"按钮
   - ✅ 应该显示：操作成功
   - ✅ 对话框关闭
   - ✅ 列表中显示新增的模板

### 测试2：文件类型验证

1. **点击"新增模板"**
2. **尝试上传非Word文件**
   - 点击"上传Word模板"
   - 选择一个PDF文件或TXT文件
   - ✅ 应该显示错误：只能上传 Word 文档!
   - ✅ 文件不应该被上传

### 测试3：文件大小限制

1. **点击"新增模板"**
2. **尝试上传大文件**
   - 点击"上传Word模板"
   - 选择一个超过10MB的Word文档
   - ✅ 应该显示错误：文件大小不能超过 10MB!
   - ✅ 文件不应该被上传

### 测试4：编辑模板

1. **找到已存在的模板**
2. **点击"编辑"按钮**
   - ✅ 对话框标题：编辑模板
   - ✅ 表单应该填充现有数据

3. **更新模板文件**
   - 上传新的Word文档
   - ✅ 应该替换原有文件

4. **保存更改**
   - 点击"确定"
   - ✅ 应该显示：操作成功

### 测试5：不上传文件直接保存

1. **点击"新增模板"**
2. **只填写基本信息**
   ```
   模板名称：测试模板002
   模板类型：选择一个类型
   ```
3. **不上传任何文件**
4. **点击"确定"**
   - ✅ 应该允许保存（文件上传是可选的）
   - ✅ 显示：操作成功

### 测试6：上传多个文件限制

1. **点击"新增模板"**
2. **尝试上传多个Word文档**
   - 上传第一个文件
   - 尝试上传第二个文件
   - ✅ 应该只保留最新上传的文件（limit=1）

## 预期结果检查表

### 功能正常
- [ ] 可以成功上传Word文档
- [ ] 可以成功上传缩略图
- [ ] 上传成功后显示正确的提示消息
- [ ] 文件列表正确显示上传的文件
- [ ] 保存后数据正确存储到数据库

### 验证正常
- [ ] 非Word文档被拒绝
- [ ] 超过10MB的文件被拒绝
- [ ] 显示正确的错误提示

### 用户体验
- [ ] 上传按钮位置合理
- [ ] 上传提示清晰
- [ ] 错误提示友好
- [ ] 操作流程顺畅

## 常见问题排查

### 问题1：上传失败，显示404错误

**原因**：上传接口不存在或路径错误

**解决方案**：
1. 检查后端是否运行
2. 访问 http://localhost:9099/docs 查看API文档
3. 确认 `/common/upload` 接口存在
4. 检查前端配置：`VITE_APP_BASE_API` 环境变量

### 问题2：上传成功但没有保存到数据库

**原因**：前端字段名与后端不匹配

**解决方案**：
1. 检查前端使用的字段名：`filePath`
2. 检查后端VO模型的字段名：`file_path`
3. 确认字段映射正确

### 问题3：上传后看不到文件

**原因**：文件路径配置错误

**解决方案**：
1. 检查后端文件存储路径配置
2. 检查文件访问权限
3. 确认静态文件服务配置正确

### 问题4：缩略图不显示

**原因**：图片URL不正确或跨域问题

**解决方案**：
1. 检查返回的URL格式
2. 检查CORS配置
3. 在浏览器开发者工具中查看网络请求

## 数据库验证

### 查询上传的模板数据

```sql
-- 查看最新上传的模板
SELECT 
  template_id,
  template_name,
  file_path,
  file_name,
  file_size,
  create_time
FROM ai_write_format_template
ORDER BY create_time DESC
LIMIT 10;
```

### 验证字段
- `file_path`：应该包含完整的文件路径
- `file_name`：应该是原始文件名
- `file_size`：应该是文件大小（字节）

## 性能测试

### 上传速度测试
1. 上传1MB的文件：应该在1秒内完成
2. 上传5MB的文件：应该在3秒内完成
3. 上传10MB的文件：应该在5秒内完成

### 并发测试
1. 同时打开多个浏览器标签
2. 在不同标签中同时上传文件
3. ✅ 所有上传应该都能成功

## 安全测试

### 文件类型伪造
1. 将.exe文件重命名为.docx
2. 尝试上传
3. ✅ 应该被后端验证拒绝

### 路径遍历攻击
1. 尝试上传文件名包含 `../` 的文件
2. ✅ 应该被过滤或拒绝

### XSS攻击
1. 在模板名称中输入 `<script>alert('xss')</script>`
2. ✅ 应该被转义显示，不执行脚本

## 测试报告模板

```markdown
# 模板上传功能测试报告

## 测试环境
- 测试日期：YYYY-MM-DD
- 测试人员：XXX
- 后端版本：X.X.X
- 前端版本：X.X.X

## 测试结果

### 功能测试
| 测试项 | 预期结果 | 实际结果 | 状态 |
|--------|----------|----------|------|
| 上传Word文档 | 成功上传 | 成功上传 | ✅ |
| 上传缩略图 | 成功上传 | 成功上传 | ✅ |
| 文件类型验证 | 拒绝非Word | 拒绝非Word | ✅ |
| 文件大小限制 | 拒绝>10MB | 拒绝>10MB | ✅ |
| 编辑模板 | 成功更新 | 成功更新 | ✅ |

### 问题记录
1. 问题描述：XXX
   - 严重程度：高/中/低
   - 复现步骤：XXX
   - 解决方案：XXX

## 总结
- 通过测试项：X/Y
- 发现问题：X个
- 建议：XXX
```

## 下一步

测试通过后，可以进行：
1. 用户验收测试（UAT）
2. 性能优化
3. 功能扩展（如批量上传、拖拽上传等）
