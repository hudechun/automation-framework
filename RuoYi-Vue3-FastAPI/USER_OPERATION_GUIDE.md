# 论文系统用户操作指南

## 一、管理员操作指南

### 1. 管理员配额问题解决

**问题**：管理员显示"余额不足"

**解决方案**：为管理员账号添加论文生成配额

#### 方法一：使用 MySQL 客户端（推荐）

1. 连接到 MySQL 数据库：
   ```bash
   mysql -h 106.53.217.96 -u root -p ruoyi-fastapi
   ```

2. 执行以下 SQL 语句：

```sql
-- 1. 查看 admin 用户的 user_id
SELECT user_id, user_name FROM sys_user WHERE user_name = 'admin';

-- 2. 检查当前配额状态（假设 user_id 是 1）
SELECT * FROM thesis_user_feature_quota 
WHERE user_id = 1 AND feature_type = 'thesis_generation';

-- 3. 如果上面查询有结果，执行 UPDATE（更新配额）
UPDATE thesis_user_feature_quota 
SET total_quota = 1000, 
    remaining_quota = 1000 - used_quota,
    update_time = NOW()
WHERE user_id = 1 AND feature_type = 'thesis_generation';

-- 4. 如果上面查询没有结果，执行 INSERT（创建新配额记录）
INSERT INTO thesis_user_feature_quota 
(user_id, feature_type, total_quota, used_quota, remaining_quota, 
 expire_time, status, create_time, update_time)
VALUES 
(1, 'thesis_generation', 1000, 0, 1000, 
 DATE_ADD(NOW(), INTERVAL 1 YEAR), '0', NOW(), NOW());

-- 5. 验证配额已添加
SELECT * FROM thesis_user_feature_quota 
WHERE user_id = 1 AND feature_type = 'thesis_generation';
```

#### 方法二：使用 Python 脚本

```bash
# 确保 MySQL 服务正在运行
python RuoYi-Vue3-FastAPI/add_admin_quota.py
```

#### 方法三：使用 SQL 文件

```bash
# 在 MySQL 客户端中执行
source RuoYi-Vue3-FastAPI/add_admin_quota.sql;
```

### 2. 管理员功能

管理员登录后可以：

1. **查看所有用户的论文**
   - 路径：论文管理 > 论文列表
   - 可以查看、编辑、删除所有用户的论文

2. **管理会员套餐**
   - 路径：会员管理 > 套餐管理
   - 可以创建、编辑、删除会员套餐
   - 设置套餐价格、配额、有效期等

3. **查看用户会员信息**
   - 路径：会员管理 > 用户会员
   - 查看所有用户的会员状态
   - 可以手动为用户开通/续费会员

4. **管理用户配额**
   - 路径：会员管理 > 配额管理
   - 查看所有用户的配额使用情况
   - 可以手动为用户增加配额

5. **查看配额使用记录**
   - 路径：会员管理 > 使用记录
   - 查看所有用户的配额使用明细

6. **管理论文模板**
   - 路径：论文管理 > 模板管理
   - 上传、编辑、删除论文模板

7. **管理 AI 模型配置**
   - 路径：系统管理 > AI 模型配置
   - 配置 OpenAI、通义千问等 AI 模型

---

## 二、普通用户操作指南

### 1. 注册和登录

1. 访问系统首页
2. 点击"注册"按钮
3. 填写用户名、密码、邮箱等信息
4. 注册成功后使用用户名和密码登录

### 2. 购买会员套餐

**步骤**：

1. 登录系统后，点击左侧菜单"会员管理" > "会员套餐"
2. 浏览可用的会员套餐：
   - 基础版：适合偶尔使用
   - 标准版：适合经常使用
   - 专业版：适合大量使用
3. 选择合适的套餐，点击"购买"按钮
4. 选择支付方式：
   - 支付宝
   - 微信支付
   - 银行卡
5. 完成支付后，系统自动激活会员
6. 配额自动充值到账户

### 3. 查看配额余额

**步骤**：

1. 点击左侧菜单"会员管理" > "我的配额"
2. 查看各项功能的配额余额：
   - 论文生成配额：剩余可生成论文次数
   - 大纲生成配额：剩余可生成大纲次数
   - 章节生成配额：剩余可生成章节次数
   - 导出配额：剩余可导出次数

### 4. 生成论文

**步骤**：

1. 点击左侧菜单"论文管理" > "论文列表"
2. 点击"新建论文"按钮
3. 填写论文信息：
   - 论文标题
   - 论文类型（本科、硕士、博士）
   - 研究方向
   - 关键词
   - 字数要求
4. 选择论文模板（可选）
5. 点击"生成论文"按钮
6. 系统自动扣除配额，开始生成论文
7. 生成完成后可以：
   - 在线预览
   - 编辑修改
   - 导出为 Word/PDF

### 5. 配额不足时的处理

**情况一：配额用完**

提示：`配额已用完`

解决方案：
1. 购买配额包（单独购买配额，不包含会员）
2. 升级会员套餐（获得更多配额）
3. 续费会员（会员过期后配额也会失效）

**情况二：配额即将用完**

提示：`配额即将用完，仅剩 X 次`

建议：提前购买配额包，避免影响使用

**情况三：会员过期**

提示：`您的会员已于 YYYY-MM-DD 过期`

解决方案：
1. 续费会员
2. 购买新的会员套餐

**情况四：未开通会员**

提示：`您还未开通会员`

解决方案：
1. 购买会员套餐
2. 联系管理员开通试用

### 6. 查看使用记录

**步骤**：

1. 点击左侧菜单"会员管理" > "使用记录"
2. 查看配额使用明细：
   - 使用时间
   - 功能类型
   - 使用数量
   - 关联业务（论文ID）

### 7. 管理我的论文

**步骤**：

1. 点击左侧菜单"论文管理" > "论文列表"
2. 查看我的所有论文
3. 可以进行的操作：
   - 查看详情
   - 编辑修改
   - 重新生成
   - 导出文档
   - 删除论文

---

## 三、配额说明

### 1. 配额类型

| 功能类型 | 说明 | 扣除规则 |
|---------|------|---------|
| 论文生成 | 生成完整论文 | 每次生成扣除 1 次 |
| 大纲生成 | 生成论文大纲 | 每次生成扣除 1 次 |
| 章节生成 | 生成单个章节 | 每次生成扣除 1 次 |
| 导出 | 导出为 Word/PDF | 每次导出扣除 1 次 |

### 2. 配额获取方式

1. **购买会员套餐**：开通会员时自动获得配额
2. **购买配额包**：单独购买配额，不包含会员权益
3. **会员续费**：续费会员时增加配额
4. **活动赠送**：参与活动获得配额奖励
5. **管理员赠送**：管理员手动增加配额

### 3. 配额有效期

- 会员配额：与会员有效期一致
- 单独购买的配额包：通常有效期 1 年
- 赠送配额：根据活动规则确定

### 4. 配额补偿

如果因系统故障导致配额扣除但功能未成功执行，系统会自动补偿配额。

---

## 四、常见问题

### Q1: 为什么我购买了会员还是显示配额不足？

**A**: 可能的原因：
1. 会员已过期，需要续费
2. 配额已用完，需要购买配额包
3. 系统配额未正确初始化，联系管理员处理

### Q2: 配额可以退款吗？

**A**: 根据系统规则：
- 未使用的配额可以申请退款
- 已使用的配额不可退款
- 具体退款政策请咨询客服

### Q3: 配额可以转让给其他用户吗？

**A**: 目前不支持配额转让功能。

### Q4: 生成论文失败会扣除配额吗？

**A**: 不会。只有成功生成论文后才会扣除配额。如果生成失败，系统会自动补偿配额。

### Q5: 如何查看我的会员到期时间？

**A**: 
1. 点击左侧菜单"会员管理" > "我的会员"
2. 查看"到期时间"字段

### Q6: 配额用完后可以继续使用系统吗？

**A**: 可以登录系统，但无法使用需要配额的功能（如生成论文）。需要购买配额后才能继续使用。

---

## 五、联系支持

如果遇到问题，可以通过以下方式联系我们：

1. **在线客服**：点击右下角客服图标
2. **邮箱**：support@example.com
3. **电话**：400-xxx-xxxx
4. **工作时间**：周一至周五 9:00-18:00

---

## 六、更新日志

- 2026-01-25：创建用户操作指南
- 包含管理员和普通用户的完整操作流程
- 详细说明配额系统的使用方法
