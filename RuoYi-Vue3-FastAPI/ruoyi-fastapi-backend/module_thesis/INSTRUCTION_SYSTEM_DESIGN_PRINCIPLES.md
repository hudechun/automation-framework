# æŒ‡ä»¤ç³»ç»Ÿè®¾è®¡åŸåˆ™ä¸æ”¹è¿›æ–¹æ¡ˆ

## ä¸€ã€é—®é¢˜åˆ†æ

### 1.1 å½“å‰é—®é¢˜

**ç”¨æˆ·æå‡ºçš„å…³é”®é—®é¢˜**ï¼š
1. âŒ **ç”Ÿæˆçš„æŒ‡ä»¤å¯èƒ½ä¸å‡†ç¡®**ï¼šAIæå–çš„æ ¼å¼ä¿¡æ¯å¯èƒ½ä¸å®Œæ•´æˆ–é”™è¯¯
2. âŒ **è½¬æ¢é€»è¾‘ä¸é è°±**ï¼šç¡¬ç¼–ç çš„è½¬æ¢é€»è¾‘æ— æ³•é€‚åº”ä¸åŒå­¦æ ¡çš„è¦æ±‚
3. âŒ **ç¼ºä¹é€šç”¨æ€§**ï¼šæ¢ä¸€ä¸ªå­¦æ ¡å°±éœ€è¦ä¿®æ”¹ä»£ç 
4. âŒ **æŒ‡ä»¤ç³»ç»Ÿæœªå……åˆ†åˆ©ç”¨**ï¼šæŒ‡ä»¤ç³»ç»Ÿæ²¡æœ‰å……åˆ†è¿ç”¨åˆ°å¤§çº²å’Œç« èŠ‚å†…å®¹ç”Ÿæˆ

### 1.2 æ ¹æœ¬åŸå› 

**è®¾è®¡ç¼ºé™·**ï¼š
- æŒ‡ä»¤ç³»ç»Ÿæ˜¯**è¢«åŠ¨çš„**ï¼šåªåœ¨æ ¼å¼åŒ–æ—¶ä½¿ç”¨
- è½¬æ¢é€»è¾‘æ˜¯**ç¡¬ç¼–ç çš„**ï¼šä¾èµ–ä»£ç ä¸­çš„å›ºå®šè§„åˆ™
- ç¼ºä¹**æè¿°æ€§è§„åˆ™**ï¼šæ²¡æœ‰é€šè¿‡æŒ‡ä»¤ç³»ç»Ÿæœ¬èº«æè¿°æ ¼å¼è¦æ±‚

---

## äºŒã€æŒ‡ä»¤ç³»ç»Ÿè®¾è®¡åŸåˆ™

### 2.1 æ ¸å¿ƒåŸåˆ™

#### åŸåˆ™1ï¼šæŒ‡ä»¤ç³»ç»Ÿåº”è¯¥æ˜¯**æè¿°æ€§çš„**ï¼Œè€Œä¸æ˜¯**è½¬æ¢æ€§çš„**

**å½“å‰é—®é¢˜**ï¼š
- ä½¿ç”¨ç¡¬ç¼–ç çš„è½¬æ¢é€»è¾‘ï¼ˆå¦‚ï¼š1.1 â†’ ç¬¬ä¸€ç« ï¼‰
- ä¾èµ–ä»£ç ä¸­çš„å›ºå®šè§„åˆ™

**æ”¹è¿›æ–¹å‘**ï¼š
- æŒ‡ä»¤ç³»ç»Ÿåº”è¯¥**æè¿°æ ¼å¼è¦æ±‚**ï¼ˆå¦‚ï¼šä¸€çº§æ ‡é¢˜ä½¿ç”¨"ç¬¬Xç« "æ ¼å¼ï¼‰
- æ ¼å¼åŒ–ä»£ç æ ¹æ®æŒ‡ä»¤**åº”ç”¨æ ¼å¼**ï¼Œè€Œä¸æ˜¯è½¬æ¢æ ¼å¼

#### åŸåˆ™2ï¼šæŒ‡ä»¤ç³»ç»Ÿåº”è¯¥**ä¸»åŠ¨å‚ä¸**æ•´ä¸ªæµç¨‹

**å½“å‰é—®é¢˜**ï¼š
- æŒ‡ä»¤ç³»ç»Ÿåªåœ¨æ ¼å¼åŒ–æ—¶ä½¿ç”¨
- å¤§çº²å’Œç« èŠ‚ç”Ÿæˆæ—¶æ²¡æœ‰ä½¿ç”¨æŒ‡ä»¤ç³»ç»Ÿ

**æ”¹è¿›æ–¹å‘**ï¼š
- **å¤§çº²ç”Ÿæˆæ—¶**ï¼šæ ¹æ®æŒ‡ä»¤ç³»ç»Ÿç”Ÿæˆç¬¦åˆæ ¼å¼è¦æ±‚çš„å¤§çº²ç»“æ„
- **ç« èŠ‚ç”Ÿæˆæ—¶**ï¼šæ ¹æ®æŒ‡ä»¤ç³»ç»Ÿç”Ÿæˆç¬¦åˆæ ¼å¼è¦æ±‚çš„ç« èŠ‚å†…å®¹
- **æ ¼å¼åŒ–æ—¶**ï¼šæ ¹æ®æŒ‡ä»¤ç³»ç»Ÿåº”ç”¨æ ¼å¼

#### åŸåˆ™3ï¼šæŒ‡ä»¤ç³»ç»Ÿåº”è¯¥**å®Œå…¨é€šç”¨**ï¼Œä¸ä¾èµ–ç¡¬ç¼–ç 

**å½“å‰é—®é¢˜**ï¼š
- è½¬æ¢é€»è¾‘ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
- ä¸åŒå­¦æ ¡éœ€è¦ä¸åŒçš„è½¬æ¢é€»è¾‘

**æ”¹è¿›æ–¹å‘**ï¼š
- æ‰€æœ‰æ ¼å¼è¦æ±‚éƒ½é€šè¿‡æŒ‡ä»¤ç³»ç»Ÿæè¿°
- æ ¼å¼åŒ–ä»£ç åªè´Ÿè´£**åº”ç”¨**æŒ‡ä»¤ï¼Œä¸è´Ÿè´£**è½¬æ¢**

---

## ä¸‰ã€æŒ‡ä»¤ç³»ç»Ÿå¦‚ä½•è¿ç”¨åˆ°å¤§çº²å’Œç« èŠ‚å†…å®¹

### 3.1 å¤§çº²ç”Ÿæˆé˜¶æ®µ

**å½“å‰æµç¨‹**ï¼š
```
ç”¨æˆ·è¾“å…¥è®ºæ–‡ä¿¡æ¯ â†’ AIç”Ÿæˆå¤§çº² â†’ ä¿å­˜å¤§çº²
```

**æ”¹è¿›æµç¨‹**ï¼š
```
ç”¨æˆ·è¾“å…¥è®ºæ–‡ä¿¡æ¯ â†’ è¯»å–æ ¼å¼æŒ‡ä»¤ â†’ AIæ ¹æ®æŒ‡ä»¤ç”Ÿæˆç¬¦åˆæ ¼å¼è¦æ±‚çš„å¤§çº² â†’ ä¿å­˜å¤§çº²
```

**æŒ‡ä»¤ç³»ç»Ÿçš„ä½œç”¨**ï¼š
1. **ç« èŠ‚ç¼–å·æ ¼å¼**ï¼šå‘Šè¯‰AIä½¿ç”¨"ç¬¬ä¸€ç« "è¿˜æ˜¯"1.1"æ ¼å¼
2. **ç« èŠ‚ç»“æ„**ï¼šå‘Šè¯‰AIéœ€è¦å“ªäº›ç« èŠ‚ï¼ˆæ‘˜è¦ã€å…³é”®è¯ã€æ­£æ–‡ã€ç»“è®ºç­‰ï¼‰
3. **æ ‡é¢˜å±‚çº§**ï¼šå‘Šè¯‰AIæ ‡é¢˜çš„å±‚çº§å…³ç³»

**å®ç°æ–¹å¼**ï¼š
```python
async def generate_outline(thesis_info, format_instructions):
    # 1. è§£ææ ¼å¼æŒ‡ä»¤
    format_config = json.loads(format_instructions)
    
    # 2. æå–ç« èŠ‚ç»“æ„è¦æ±‚
    document_structure = format_config.get('application_rules', {}).get('document_structure', {})
    section_order = document_structure.get('section_order', [])
    required_sections = document_structure.get('required_sections', [])
    
    # 3. æå–ç« èŠ‚ç¼–å·æ ¼å¼è¦æ±‚
    heading_detection = format_config.get('application_rules', {}).get('heading_detection', '')
    
    # 4. æ„å»ºæç¤ºè¯ï¼Œå‘Šè¯‰AIæ ¼å¼è¦æ±‚
    prompt = f"""
    æ ¹æ®ä»¥ä¸‹æ ¼å¼è¦æ±‚ç”Ÿæˆè®ºæ–‡å¤§çº²ï¼š
    
    ç« èŠ‚ç»“æ„é¡ºåºï¼š{', '.join(section_order)}
    å¿…å¡«ç« èŠ‚ï¼š{', '.join(required_sections)}
    ç« èŠ‚ç¼–å·æ ¼å¼ï¼š{heading_detection}
    
    è¯·ç”Ÿæˆç¬¦åˆä»¥ä¸Šæ ¼å¼è¦æ±‚çš„å¤§çº²ã€‚
    """
    
    # 5. AIç”Ÿæˆå¤§çº²ï¼ˆå·²ç»ç¬¦åˆæ ¼å¼è¦æ±‚ï¼‰
    outline = await ai.generate(prompt)
    
    return outline
```

---

### 3.2 ç« èŠ‚å†…å®¹ç”Ÿæˆé˜¶æ®µ

**å½“å‰æµç¨‹**ï¼š
```
å¤§çº² â†’ AIç”Ÿæˆç« èŠ‚å†…å®¹ â†’ ä¿å­˜ç« èŠ‚
```

**æ”¹è¿›æµç¨‹**ï¼š
```
å¤§çº² â†’ è¯»å–æ ¼å¼æŒ‡ä»¤ â†’ AIæ ¹æ®æŒ‡ä»¤ç”Ÿæˆç¬¦åˆæ ¼å¼è¦æ±‚çš„ç« èŠ‚å†…å®¹ â†’ ä¿å­˜ç« èŠ‚
```

**æŒ‡ä»¤ç³»ç»Ÿçš„ä½œç”¨**ï¼š
1. **æ ‡é¢˜æ ¼å¼**ï¼šå‘Šè¯‰AIæ ‡é¢˜åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ ¼å¼ï¼ˆå­—ä½“ã€å­—å·ã€å¯¹é½ç­‰ï¼‰
2. **æ®µè½æ ¼å¼**ï¼šå‘Šè¯‰AIæ®µè½åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ ¼å¼ï¼ˆè¡Œè·ã€ç¼©è¿›ç­‰ï¼‰
3. **ç‰¹æ®Šç« èŠ‚æ ¼å¼**ï¼šå‘Šè¯‰AIæ‘˜è¦ã€å…³é”®è¯ç­‰ç‰¹æ®Šç« èŠ‚çš„æ ¼å¼è¦æ±‚

**å®ç°æ–¹å¼**ï¼š
```python
async def generate_chapter(chapter_info, format_instructions):
    # 1. è§£ææ ¼å¼æŒ‡ä»¤
    format_config = json.loads(format_instructions)
    
    # 2. æå–ç« èŠ‚æ ¼å¼è¦æ±‚
    chapter_level = chapter_info.get('level', 1)
    heading_config = format_config.get('headings', {}).get(f'h{chapter_level}', {})
    
    # 3. æå–æ®µè½æ ¼å¼è¦æ±‚
    paragraph_config = format_config.get('paragraph', {})
    
    # 4. æ„å»ºæç¤ºè¯ï¼Œå‘Šè¯‰AIæ ¼å¼è¦æ±‚
    prompt = f"""
    æ ¹æ®ä»¥ä¸‹æ ¼å¼è¦æ±‚ç”Ÿæˆç« èŠ‚å†…å®¹ï¼š
    
    æ ‡é¢˜æ ¼å¼ï¼š
    - å­—ä½“ï¼š{heading_config.get('font_name', 'é»‘ä½“')}
    - å­—å·ï¼š{heading_config.get('font_size_pt', 14)}ç£…
    - å¯¹é½ï¼š{heading_config.get('alignment', 'left')}
    
    æ®µè½æ ¼å¼ï¼š
    - è¡Œè·ï¼š{paragraph_config.get('line_spacing', 1.5)}å€
    - é¦–è¡Œç¼©è¿›ï¼š{paragraph_config.get('first_line_indent_chars', 0)}å­—ç¬¦
    
    è¯·ç”Ÿæˆç¬¦åˆä»¥ä¸Šæ ¼å¼è¦æ±‚çš„ç« èŠ‚å†…å®¹ã€‚
    """
    
    # 5. AIç”Ÿæˆç« èŠ‚å†…å®¹ï¼ˆå·²ç»ç¬¦åˆæ ¼å¼è¦æ±‚ï¼‰
    chapter_content = await ai.generate(prompt)
    
    return chapter_content
```

---

### 3.3 æ ¼å¼åŒ–é˜¶æ®µ

**å½“å‰æµç¨‹**ï¼š
```
ç« èŠ‚å†…å®¹ â†’ è¯»å–æ ¼å¼æŒ‡ä»¤ â†’ åº”ç”¨æ ¼å¼ â†’ ç”Ÿæˆæ–‡æ¡£
```

**æ”¹è¿›æµç¨‹**ï¼š
```
ç« èŠ‚å†…å®¹ï¼ˆå·²ç»ç¬¦åˆæ ¼å¼è¦æ±‚ï¼‰ â†’ è¯»å–æ ¼å¼æŒ‡ä»¤ â†’ åº”ç”¨æ ¼å¼ â†’ ç”Ÿæˆæ–‡æ¡£
```

**æŒ‡ä»¤ç³»ç»Ÿçš„ä½œç”¨**ï¼š
1. **åº”ç”¨æ ¼å¼**ï¼šæ ¹æ®æŒ‡ä»¤åº”ç”¨å­—ä½“ã€å­—å·ã€å¯¹é½ç­‰æ ¼å¼
2. **éªŒè¯æ ¼å¼**ï¼šéªŒè¯å†…å®¹æ˜¯å¦ç¬¦åˆæ ¼å¼è¦æ±‚
3. **è°ƒæ•´æ ¼å¼**ï¼šå¦‚æœä¸ç¬¦åˆï¼Œè¿›è¡Œå¾®è°ƒ

---

## å››ã€æ”¹è¿›æ–¹æ¡ˆ

### 4.1 æŒ‡ä»¤ç³»ç»Ÿå¢å¼ºï¼šæ·»åŠ æ ¼å¼æè¿°è§„åˆ™

**å½“å‰æŒ‡ä»¤ç³»ç»Ÿ**ï¼š
- åªæè¿°æ ¼å¼å±æ€§ï¼ˆå­—ä½“ã€å­—å·ç­‰ï¼‰
- ä¸æè¿°æ ¼å¼è§„åˆ™ï¼ˆç« èŠ‚ç¼–å·æ ¼å¼ã€æ ‡é¢˜æ ¼å¼ç­‰ï¼‰

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š
åœ¨æŒ‡ä»¤ç³»ç»Ÿä¸­æ·»åŠ **æ ¼å¼æè¿°è§„åˆ™**ï¼Œè€Œä¸æ˜¯è½¬æ¢è§„åˆ™ï¼š

```json
{
  "application_rules": {
    "heading_detection": "é€šè¿‡æ®µè½å‰ç¼€æ•°å­—è¯†åˆ«å±‚çº§",
    
    // æ·»åŠ ï¼šç« èŠ‚ç¼–å·æ ¼å¼æè¿°ï¼ˆè€Œä¸æ˜¯è½¬æ¢è§„åˆ™ï¼‰
    "chapter_numbering_format": {
      "level_1": {
        "format_type": "chinese_chapter",  // ä¸­æ–‡ç« èŠ‚æ ¼å¼ï¼šç¬¬Xç« 
        "pattern": "ç¬¬{number}ç«  {title}",  // æ ¼å¼æ¨¡æ¿
        "number_style": "chinese"  // æ•°å­—æ ·å¼ï¼šchinese/arabic/roman
      },
      "level_2": {
        "format_type": "numbered",  // æ•°å­—æ ¼å¼ï¼š1.1
        "pattern": "{parent}.{number} {title}",
        "number_style": "arabic"
      }
    },
    
    // æ·»åŠ ï¼šæ ‡é¢˜æ ¼å¼æè¿°
    "heading_format_rules": {
      "level_1": {
        "title_prefix": "ç¬¬",  // æ ‡é¢˜å‰ç¼€
        "title_suffix": "ç« ",  // æ ‡é¢˜åç¼€
        "number_position": "before_title"  // ç¼–å·ä½ç½®ï¼šbefore_title/after_title/none
      }
    },
    
    // ç§»é™¤ï¼šchapter_numbering_conversionï¼ˆè½¬æ¢è§„åˆ™ï¼‰
    // æ”¹ä¸ºï¼šé€šè¿‡æ ¼å¼æè¿°è§„åˆ™ï¼Œè®©AIåœ¨ç”Ÿæˆæ—¶å°±ä½¿ç”¨æ­£ç¡®çš„æ ¼å¼
  }
}
```

---

### 4.2 å¤§çº²ç”Ÿæˆæ”¹è¿›ï¼šæ ¹æ®æŒ‡ä»¤ç”Ÿæˆ

**æ”¹è¿›å‰**ï¼š
```python
# AIç”Ÿæˆå¤§çº²ï¼Œæ ¼å¼å¯èƒ½ä¸ç¬¦åˆè¦æ±‚
outline = await ai.generate_outline(thesis_info)
```

**æ”¹è¿›å**ï¼š
```python
# 1. è¯»å–æ ¼å¼æŒ‡ä»¤
format_instructions = await get_format_instructions(template_id)

# 2. æå–æ ¼å¼è¦æ±‚
chapter_numbering_format = format_instructions.get('application_rules', {}).get('chapter_numbering_format', {})

# 3. å‘Šè¯‰AIæ ¼å¼è¦æ±‚
prompt = f"""
ç”Ÿæˆè®ºæ–‡å¤§çº²ï¼Œè¦æ±‚ï¼š
1. ä¸€çº§æ ‡é¢˜ä½¿ç”¨æ ¼å¼ï¼š{chapter_numbering_format.get('level_1', {}).get('pattern', 'ç¬¬Xç«  æ ‡é¢˜')}
2. äºŒçº§æ ‡é¢˜ä½¿ç”¨æ ¼å¼ï¼š{chapter_numbering_format.get('level_2', {}).get('pattern', 'X.Y æ ‡é¢˜')}
3. å¿…é¡»åŒ…å«ä»¥ä¸‹ç« èŠ‚ï¼š{required_sections}
"""

# 4. AIç”Ÿæˆç¬¦åˆæ ¼å¼è¦æ±‚çš„å¤§çº²
outline = await ai.generate_outline(thesis_info, format_requirements=prompt)
```

---

### 4.3 ç« èŠ‚ç”Ÿæˆæ”¹è¿›ï¼šæ ¹æ®æŒ‡ä»¤ç”Ÿæˆ

**æ”¹è¿›å‰**ï¼š
```python
# AIç”Ÿæˆç« èŠ‚å†…å®¹ï¼Œæ ¼å¼å¯èƒ½ä¸ç¬¦åˆè¦æ±‚
chapter_content = await ai.generate_chapter(chapter_info)
```

**æ”¹è¿›å**ï¼š
```python
# 1. è¯»å–æ ¼å¼æŒ‡ä»¤
format_instructions = await get_format_instructions(template_id)

# 2. æå–ç« èŠ‚æ ¼å¼è¦æ±‚
heading_config = format_instructions.get('headings', {}).get(f'h{chapter_level}', {})
paragraph_config = format_instructions.get('paragraph', {})

# 3. å‘Šè¯‰AIæ ¼å¼è¦æ±‚
prompt = f"""
ç”Ÿæˆç« èŠ‚å†…å®¹ï¼Œè¦æ±‚ï¼š
1. æ ‡é¢˜æ ¼å¼ï¼š{heading_config.get('font_name')} {heading_config.get('font_size_pt')}ç£…ï¼Œ{heading_config.get('alignment')}å¯¹é½
2. æ®µè½æ ¼å¼ï¼šè¡Œè·{paragraph_config.get('line_spacing')}å€ï¼Œé¦–è¡Œç¼©è¿›{paragraph_config.get('first_line_indent_chars')}å­—ç¬¦
"""

# 4. AIç”Ÿæˆç¬¦åˆæ ¼å¼è¦æ±‚çš„ç« èŠ‚å†…å®¹
chapter_content = await ai.generate_chapter(chapter_info, format_requirements=prompt)
```

---

### 4.4 æ ¼å¼åŒ–æ”¹è¿›ï¼šåªåº”ç”¨æ ¼å¼ï¼Œä¸è½¬æ¢æ ¼å¼

**æ”¹è¿›å‰**ï¼š
```python
# 1. è·å–ç« èŠ‚
chapters = get_chapters()

# 2. è½¬æ¢æ ¼å¼ï¼ˆç¡¬ç¼–ç ï¼‰
chapters = convert_chapter_numbering(chapters)  # 1.1 â†’ ç¬¬ä¸€ç« 

# 3. åº”ç”¨æ ¼å¼
apply_format(chapters, format_instructions)
```

**æ”¹è¿›å**ï¼š
```python
# 1. è·å–ç« èŠ‚ï¼ˆå·²ç»ç¬¦åˆæ ¼å¼è¦æ±‚ï¼‰
chapters = get_chapters()

# 2. ç›´æ¥åº”ç”¨æ ¼å¼ï¼ˆä¸éœ€è¦è½¬æ¢ï¼‰
apply_format(chapters, format_instructions)
```

---

## äº”ã€æŒ‡ä»¤ç³»ç»Ÿè®¾è®¡æ”¹è¿›

### 5.1 æ·»åŠ æ ¼å¼æè¿°è§„åˆ™

åœ¨ `application_rules` ä¸­æ·»åŠ ï¼š

```json
{
  "application_rules": {
    "heading_detection": "æ ‡é¢˜è¯†åˆ«è§„åˆ™",
    
    // æ–°å¢ï¼šç« èŠ‚ç¼–å·æ ¼å¼æè¿°
    "chapter_numbering_format": {
      "level_1": {
        "format_type": "chinese_chapter/numbered/roman",
        "pattern": "æ ¼å¼æ¨¡æ¿ï¼ˆå¦‚ï¼šç¬¬{number}ç«  {title}ï¼‰",
        "number_style": "chinese/arabic/roman",
        "examples": ["ç¬¬ä¸€ç«  å¼•è¨€", "ç¬¬äºŒç«  ç ”ç©¶èƒŒæ™¯"]
      },
      "level_2": {
        "format_type": "numbered",
        "pattern": "{parent}.{number} {title}",
        "number_style": "arabic",
        "examples": ["1.1 ç ”ç©¶èƒŒæ™¯", "1.2 ç ”ç©¶æ„ä¹‰"]
      }
    },
    
    // æ–°å¢ï¼šæ ‡é¢˜æ ¼å¼è§„åˆ™
    "heading_format_rules": {
      "level_1": {
        "title_prefix": "ç¬¬",
        "title_suffix": "ç« ",
        "number_position": "before_title",
        "separator": " "  // ç¼–å·å’Œæ ‡é¢˜ä¹‹é—´çš„åˆ†éš”ç¬¦
      }
    },
    
    // æ–°å¢ï¼šç‰¹æ®Šç« èŠ‚æ ¼å¼è§„åˆ™
    "special_section_format_rules": {
      "abstract": {
        "title": "æ‘˜è¦",
        "should_have_numbering": false,
        "position": "after_toc"
      },
      "conclusion": {
        "title": "ç»“è¯­",  // ä¸æ˜¯"ç»“è®º"
        "should_have_numbering": false,
        "position": "before_references"
      },
      "references": {
        "title": "å‚è€ƒæ–‡çŒ®",
        "should_have_numbering": false,
        "position": "before_appendix"
      }
    }
  }
}
```

---

### 5.2 ç§»é™¤è½¬æ¢é€»è¾‘

**ç§»é™¤**ï¼š
- `chapter_numbering_conversion`ï¼ˆè½¬æ¢è§„åˆ™ï¼‰
- `abstract_extraction`ï¼ˆæå–è§„åˆ™ï¼‰

**æ”¹ä¸º**ï¼š
- é€šè¿‡æ ¼å¼æè¿°è§„åˆ™ï¼Œè®©AIåœ¨ç”Ÿæˆæ—¶å°±ä½¿ç”¨æ­£ç¡®çš„æ ¼å¼
- æ ¼å¼åŒ–æ—¶åªåº”ç”¨æ ¼å¼ï¼Œä¸è½¬æ¢æ ¼å¼

---

## å…­ã€å®ç°å»ºè®®

### 6.1 å¤§çº²ç”Ÿæˆæ—¶ä½¿ç”¨æŒ‡ä»¤ç³»ç»Ÿ

```python
async def generate_outline(thesis_info, template_id):
    # 1. è¯»å–æ ¼å¼æŒ‡ä»¤
    template = await get_template(template_id)
    format_instructions = json.loads(template.format_data)
    
    # 2. æå–æ ¼å¼è¦æ±‚
    chapter_numbering = format_instructions.get('application_rules', {}).get('chapter_numbering_format', {})
    document_structure = format_instructions.get('application_rules', {}).get('document_structure', {})
    
    # 3. æ„å»ºæ ¼å¼è¦æ±‚æç¤ºè¯
    format_requirements = f"""
    æ ¼å¼è¦æ±‚ï¼š
    1. ä¸€çº§æ ‡é¢˜æ ¼å¼ï¼š{chapter_numbering.get('level_1', {}).get('pattern', 'ç¬¬Xç«  æ ‡é¢˜')}
    2. äºŒçº§æ ‡é¢˜æ ¼å¼ï¼š{chapter_numbering.get('level_2', {}).get('pattern', 'X.Y æ ‡é¢˜')}
    3. ç« èŠ‚é¡ºåºï¼š{', '.join(document_structure.get('section_order', []))}
    """
    
    # 4. AIç”Ÿæˆç¬¦åˆæ ¼å¼è¦æ±‚çš„å¤§çº²
    outline = await ai.generate_outline(thesis_info, format_requirements)
    
    return outline
```

---

### 6.2 ç« èŠ‚ç”Ÿæˆæ—¶ä½¿ç”¨æŒ‡ä»¤ç³»ç»Ÿ

```python
async def generate_chapter(chapter_info, template_id):
    # 1. è¯»å–æ ¼å¼æŒ‡ä»¤
    template = await get_template(template_id)
    format_instructions = json.loads(template.format_data)
    
    # 2. æå–ç« èŠ‚æ ¼å¼è¦æ±‚
    chapter_level = chapter_info.get('level', 1)
    heading_config = format_instructions.get('headings', {}).get(f'h{chapter_level}', {})
    paragraph_config = format_instructions.get('paragraph', {})
    
    # 3. æ„å»ºæ ¼å¼è¦æ±‚æç¤ºè¯
    format_requirements = f"""
    æ ¼å¼è¦æ±‚ï¼š
    1. æ ‡é¢˜ï¼š{heading_config.get('font_name')} {heading_config.get('font_size_pt')}ç£…ï¼Œ{heading_config.get('alignment')}å¯¹é½
    2. æ®µè½ï¼šè¡Œè·{paragraph_config.get('line_spacing')}å€ï¼Œé¦–è¡Œç¼©è¿›{paragraph_config.get('first_line_indent_chars')}å­—ç¬¦
    """
    
    # 4. AIç”Ÿæˆç¬¦åˆæ ¼å¼è¦æ±‚çš„ç« èŠ‚å†…å®¹
    chapter_content = await ai.generate_chapter(chapter_info, format_requirements)
    
    return chapter_content
```

---

### 6.3 æ ¼å¼åŒ–æ—¶åªåº”ç”¨æ ¼å¼

```python
async def format_thesis(chapters, format_instructions):
    # 1. è¯»å–æ ¼å¼æŒ‡ä»¤
    format_config = json.loads(format_instructions)
    
    # 2. ç›´æ¥åº”ç”¨æ ¼å¼ï¼ˆä¸éœ€è¦è½¬æ¢ï¼‰
    # å› ä¸ºå¤§çº²å’Œç« èŠ‚ç”Ÿæˆæ—¶å·²ç»ä½¿ç”¨äº†æ­£ç¡®çš„æ ¼å¼
    apply_format(chapters, format_config)
    
    # 3. ç”Ÿæˆæ–‡æ¡£
    generate_document(chapters)
```

---

## ä¸ƒã€æ€»ç»“

### âœ… æ”¹è¿›æ–¹å‘

1. **æŒ‡ä»¤ç³»ç»Ÿåº”è¯¥æ˜¯æè¿°æ€§çš„**ï¼š
   - æè¿°æ ¼å¼è¦æ±‚ï¼ˆç« èŠ‚ç¼–å·æ ¼å¼ã€æ ‡é¢˜æ ¼å¼ç­‰ï¼‰
   - ä¸æè¿°è½¬æ¢è§„åˆ™

2. **æŒ‡ä»¤ç³»ç»Ÿåº”è¯¥ä¸»åŠ¨å‚ä¸**ï¼š
   - å¤§çº²ç”Ÿæˆæ—¶ä½¿ç”¨æŒ‡ä»¤ç³»ç»Ÿ
   - ç« èŠ‚ç”Ÿæˆæ—¶ä½¿ç”¨æŒ‡ä»¤ç³»ç»Ÿ
   - æ ¼å¼åŒ–æ—¶ä½¿ç”¨æŒ‡ä»¤ç³»ç»Ÿ

3. **ç§»é™¤ç¡¬ç¼–ç çš„è½¬æ¢é€»è¾‘**ï¼š
   - ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç è½¬æ¢è§„åˆ™
   - é€šè¿‡æŒ‡ä»¤ç³»ç»Ÿæè¿°æ ¼å¼è¦æ±‚
   - AIåœ¨ç”Ÿæˆæ—¶å°±ä½¿ç”¨æ­£ç¡®çš„æ ¼å¼

### ğŸ¯ æ ¸å¿ƒæ€æƒ³

**"æŒ‡ä»¤ç³»ç»Ÿæè¿°æ ¼å¼è¦æ±‚ï¼ŒAIåœ¨ç”Ÿæˆæ—¶å°±éµå¾ªæ ¼å¼è¦æ±‚ï¼Œæ ¼å¼åŒ–æ—¶åªåº”ç”¨æ ¼å¼"**

è¿™æ ·ï¼š
- âœ… æŒ‡ä»¤ç³»ç»Ÿå®Œå…¨é€šç”¨
- âœ… ä¸éœ€è¦ç¡¬ç¼–ç çš„è½¬æ¢é€»è¾‘
- âœ… é€‚åº”ä¸åŒå­¦æ ¡çš„è¦æ±‚
- âœ… æŒ‡ä»¤ç³»ç»Ÿå……åˆ†è¿ç”¨åˆ°å¤§çº²å’Œç« èŠ‚å†…å®¹
